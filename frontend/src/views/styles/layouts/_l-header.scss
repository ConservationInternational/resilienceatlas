@use '../sass-modules' as *;
@use '../mixins' as *;
@use '../variables' as *;

.l-header,
.l-header--fullscreen {
  display: none;
  position: relative;
  z-index: 5;
  height: rem($header-height);
  box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.2);
  transition: transform 0.3s ease;
  transform: translatey(-100%);

  .is-not-bare & {
    display: block;
    transform: translatey(0);
  }
}

.l-header-nav {
  max-width: rem($content-width);
  margin: 0 auto;
  padding: 0 rem($content-margin);
  position: relative;
  z-index: 2;
  background-color: rgba($bg-color-1, 0.7);

  @extend %clearfix;

  .is-journey-map.l-main--embed & {
    display: none;
  }

  .is-indicators &,
  .is-atlas &,
  .is-vs-theme & {
    background-color: rgba(#222222, 0.7);
  }

  .is-ci-theme & {
    background-color: rgba($bg-color-1, 0.7);
  }

  .l-main--embed & {
    padding-left: rem(20px);

    &:before {
      display: none;
    }
  }

  > ul {
    @extend %clean-lists;
    opacity: 1;
  }

  .brand-area {
    float: left;
    padding: rem(5px) 0;
    opacity: 1;

    a {
      position: relative;
      display: block;
      width: rem(200px);
      height: rem($header-height - 20px);
      padding: rem(5px) 0;
      // background-image: image-url("logo-ci.png");
      background-repeat: no-repeat;
      background-position: left center;
      background-size: contain;
      text-indent: -99999px;

      // TODO: Remove this?
      // .is-indicators &,
      // .is-atlas &,
      // .is-vs-theme & {
      //   // background-image: image-url("logo-vs.png");
      // }

      // .is-ci-theme & {
      //   // background-image: image-url("logo-ci.png");
      // }

      &:hover {
        text-decoration: none;
      }
    }
  }

  .nav-area {
    float: right;
    // margin-right: -rem($margin);

    &.-resilience {
      .is-indicators &,
      .is-atlas & {
        display: none;
      }
    }

    &.-vital-sign {
      display: none;

      .is-indicators &,
      .is-atlas & {
        display: block;

        a {
          color: $white;

          &:hover {
            background-color: rgba($white, 0.1);
          }
        }
      }
    }

    .item-separator {
      height: 20px;
      border-left: 1px solid $gray-medium;
      margin-right: rem(20px);
    }

    > li {
      position: relative;
      display: flex;
      display: -ms-box;
      justify-content: center;
      align-items: center;
      float: left;
      height: rem($header-height);
      margin-left: rem(div($margin, 2));

      // Force Next.js Link components to display as clickable
      > a {
        cursor: pointer !important;
        
        &:hover {
          cursor: pointer !important;
        }
      }

      &:hover > ul {
        display: block;
      }

      &.language-switcher {
        margin-left: 0;
        max-width: 180px;

        ul {
          max-width: 150px;
        }

        .nav-item {
          padding-left: 10px;
        }

        .language-item {
          padding: 0;
        }

        .language-button {
          padding: 10px 30px 10px 10px;
          width: 100%;
          text-align: left;
        }
      }

      > ul {
        display: none;
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 200px;
        padding: 0;
        transform: translate(-50%, 100%);
        font-size: rem(14px);
        background: $white;

        > li {
          display: block;
          position: relative;
          padding: 10px 30px 10px 10px;
          cursor: pointer;

          &:not(.-childless):after {
            display: block;
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: $theme-color-default;
            font-size: 0.75rem;
            content: 'â–¶';
          }

          &:hover {
            background: $white-medium;

            &:after {
              color: $blue;
            }

            > ul {
              display: block;
            }
          }

          > ul {
            display: none;
            position: absolute;
            left: 100%;
            top: 0;
            width: 200px;
            padding: 0;
            background: $white;

            li {
              padding: 10px;
              list-style: none;

              &:hover {
                background: $white-medium;
              }

              a {
                padding: 0;
                text-transform: none;
              }
            }
          }

          &.is-link {
            &:after {
              display: none;
            }

            > a {
              padding: 0;
            }
          }
        }
      }
    }

    a, button, .nav-item {
      display: block;
      padding: rem(10px);
      border-radius: 3px;
      font-size: rem(14px);
      text-transform: uppercase;
      transition: 0.2s ease-in;
      cursor: pointer;

      &:not(.is-current) {
        color: var(--theme-color);
      }

      &:hover {
        text-decoration: none;
        cursor: pointer;
      }

      &:not(.web-link):hover:not(.is-current) {
        background-color: rgba($bg-color-2, 0.1);
      }

      &.is-current,
      &.is-current:hover {
        background-color: var(--theme-color, #0089CC);
        color: $font-color-3;
      }
    }

    // Ensure Next.js Link components have proper styling
    a[href] {
      cursor: pointer;
      
      &:hover {
        cursor: pointer;
      }
    }

    // Force styling for direct child links of nav items
    > li > a {
      display: block !important;
      padding: rem(10px) !important;
      border-radius: 3px !important;
      font-size: rem(14px) !important;
      text-transform: uppercase !important;
      transition: 0.2s ease-in !important;
      cursor: pointer !important;
      text-decoration: none !important;

      &:not(.is-current) {
        color: var(--theme-color, #333333) !important;
      }

      &:hover:not(.is-current) {
        text-decoration: none !important;
        cursor: pointer !important;
        background-color: rgba($bg-color-2, 0.1) !important;
      }

      &.is-current,
      &.is-current:hover {
        background-color: var(--theme-color, #0089CC) !important;
        color: $font-color-3 !important;
        font-weight: 600 !important;
      }
    }

    // Ultra high specificity for current navigation links
    .nav-area > li > a.is-current,
    .nav-area.-resilience > li > a.is-current {
      background-color: var(--theme-color, #0089CC) !important;
      color: white !important;
      font-weight: 600 !important;
    }

    button {
      background: none;
      border: none;
      font-weight: 500;
    }

    .l-main--embed & {
      a {
        text-transform: none;
      }
    }
  }

  .web-link {
    float: right;
    color: $font-color-2;
  }

  .l-header--fullscreen & {
    max-width: none;

    .row {
      max-width: none;
    }
  }

  .l-main--embed & {
    background-color: transparent;

    .nav-area {
      float: none;

      li {
        margin: 0;
        height: auto;
      }

      a {
        padding: rem(10px) 0;
      }
    }

    .brand-area {
      float: none;
      padding: 0;
    }
  }
}

.l-hero {
  position: relative;
  margin-top: -65px;
  width: 100%;
  height: rem(310px);
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
  display: flex;
  align-items: center;
  @extend %clearfix;

  h1 {
    color: $font-color-3;
    font-size: rem(48px);
    margin-top: 80px;
  }

  .credits {
    position: absolute;
    bottom: 10px;
    right: 20px;
    margin: 0;

    a {
      color: $font-color-3;
    }
  }
}

.l-section-nav {
  background-color: rgba(#757575, 0.1);
  @extend %clearfix;
}

// Force white text for current navigation items with maximum specificity
.nav-area.-resilience li a.nav-current-forced,
.nav-area li a.nav-current-forced,
a.nav-current-forced {
  color: white !important;
  background-color: #0089CC !important;
  font-weight: 600 !important;
}

// Ensure hover state maintains the current styling
.nav-area.-resilience li a.nav-current-forced:hover,
.nav-area li a.nav-current-forced:hover,
a.nav-current-forced:hover {
  color: white !important;
  background-color: #0089CC !important;
  font-weight: 600 !important;
}

// Hide mobile menu toggle on desktop
.mobile-menu-toggle {
  display: none;
}

// Hide mobile expand indicator on desktop
.mobile-expand-indicator {
  display: none;
}

// Mobile navigation styles
@media screen and (max-width: $breakpoint-mobile) {
  .l-header,
  .l-header--fullscreen {
    height: rem(60px); // Slightly taller for mobile
    overflow: visible; // Allow fixed children to escape
  }

  .l-header-nav {
    padding: 0 rem(10px);
    overflow: visible; // Allow fixed children to escape
    
    .brand-area {
      float: left;
      padding: rem(10px) 0;
      width: calc(100% - 60px); // Leave space for hamburger button
      
      a {
        width: rem(160px);
        height: rem(40px);
        font-size: rem(16px);
      }
    }

    // Hamburger menu button
    .mobile-menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: rem(10px);
      right: rem(10px);
      width: rem(40px);
      height: rem(40px);
      background: none;
      border: none;
      cursor: pointer;
      z-index: 1001;
      padding: 0;

      // Hamburger icon
      span {
        display: block;
        width: rem(24px);
        height: rem(2px);
        background-color: var(--theme-color, #333333);
        position: relative;
        transition: all 0.3s ease;

        &:before,
        &:after {
          content: '';
          display: block;
          width: rem(24px);
          height: rem(2px);
          background-color: var(--theme-color, #333333);
          position: absolute;
          transition: all 0.3s ease;
        }

        &:before {
          top: rem(-8px);
        }

        &:after {
          top: rem(8px);
        }
      }

      // Transform to X when menu is open
      &.is-open {
        span {
          background-color: transparent;

          &:before {
            top: 0;
            transform: rotate(45deg);
          }

          &:after {
            top: 0;
            transform: rotate(-45deg);
          }
        }
      }
    }

    // Mobile navigation menu
    .nav-area {
      // Hidden by default on mobile
      display: none;
      
      // Show mobile expand indicator on mobile
      .mobile-expand-indicator {
        display: inline;
        font-size: rem(10px);
        margin-left: rem(5px);
        color: var(--theme-color, #333333);
      }

      // When nav-area.-resilience.is-open is active, show as fullscreen overlay
      &.-resilience.is-open {
        display: block !important;
        position: fixed !important;
        top: 60px !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        height: calc(100vh - 60px) !important;
        height: calc(100dvh - 60px) !important; // Dynamic viewport height for mobile
        background-color: $bg-color-1 !important;
        z-index: 9999 !important; // Very high z-index to escape any stacking context
        overflow-y: auto !important;
        padding: rem(20px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;

        // Show all list items
        > li {
          display: block !important;
          float: none !important;
          height: auto !important;
          margin-left: 0 !important;
          margin-bottom: rem(5px) !important;
          visibility: visible !important;
          opacity: 1 !important;

          > a {
            display: block !important;
            padding: rem(15px) rem(10px) !important;
            border-bottom: 1px solid rgba($gray-medium, 0.2);
            color: var(--theme-color, #333333) !important;
          }

          // Nested menus
          > ul {
            display: none !important;
            position: static;
            transform: none;
            width: 100%;
            margin-top: rem(5px);
            margin-bottom: rem(10px);
            box-shadow: none;
            background-color: rgba($gray-medium, 0.05);

            > li {
              display: block !important;
              border-bottom: 1px solid rgba($gray-medium, 0.1);
              padding-left: rem(15px); // Indent nested items
              
              a {
                display: block;
                padding: rem(12px) rem(10px);
                color: var(--theme-color, #333333);
                text-decoration: none;
                
                &:hover {
                  background-color: $bg-color-3;
                }
              }
            }
          }

          // Show nested menu when parent has 'is-expanded' class
          &.is-expanded > ul {
            display: block !important;
          }
        }

        .language-switcher {
          margin-top: rem(10px);
          padding-top: rem(10px);
          border-top: 1px solid rgba($gray-medium, 0.3);
        }
      }

      // Keep language switcher always visible
      &:not(.-resilience):not(.-vital-sign) {
        display: block;
        position: absolute;
        top: rem(10px);
        right: rem(60px);
        bottom: auto;
        background: transparent;
        box-shadow: none;
        padding: 0;
        width: auto;
        z-index: 1001;

        .language-switcher {
          height: rem(40px);
          margin: 0;

          ul {
            right: 0;
            left: auto;
          }
        }
      }
      
      // Hide vital signs link on mobile
      &.-vital-sign {
        display: none;
      }
    }
  }
}

// Tablet adjustments
@media screen and (min-width: $breakpoint-tablet-min) and (max-width: $breakpoint-tablet-max) {
  .l-header-nav {
    .nav-area.-resilience {
      > li {
        margin-left: rem(8px);
        
        a {
          padding: rem(8px) !important;
          font-size: rem(13px) !important;
        }
      }
    }
  }
}

// Mobile menu portal styles (rendered outside header via React portal)
.mobile-menu-overlay {
  display: none;
  
  @media screen and (max-width: $breakpoint-mobile) {
    display: block;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9998;
  }
}

.mobile-menu-panel {
  display: none;
  
  @media screen and (max-width: $breakpoint-mobile) {
    display: block;
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: $bg-color-1;
    z-index: 9999;
    overflow-y: auto;
    padding: rem(20px);
    list-style: none;
    margin: 0;
    
    > li {
      display: block;
      margin-bottom: rem(5px);
      
      > a, > button {
        display: block;
        padding: rem(15px) rem(10px);
        border-bottom: 1px solid rgba($gray-medium, 0.2);
        color: #333333;
        text-decoration: none;
        font-size: rem(16px);
        text-transform: uppercase;
        background: none;
        border-left: none;
        border-right: none;
        border-top: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        
        &:hover {
          background-color: rgba($gray-medium, 0.1);
        }
      }
      
      .mobile-expand-indicator {
        float: right;
        font-size: rem(12px);
      }
    }
    
    .mobile-submenu {
      list-style: none;
      margin: 0;
      padding: 0;
      background-color: rgba($gray-medium, 0.05);
      
      li {
        display: block;
        
        a, span {
          display: block;
          padding: rem(12px) rem(20px);
          color: #333333;
          text-decoration: none;
          font-size: rem(14px);
          border-bottom: 1px solid rgba($gray-medium, 0.1);
          
          &:hover {
            background-color: rgba($gray-medium, 0.1);
          }
        }
      }
    }
    
    .mobile-menu-language {
      margin-top: rem(20px);
      padding-top: rem(15px);
      border-top: 1px solid rgba($gray-medium, 0.3);
    }
  }
}

// Hide desktop navigation on mobile
@media screen and (max-width: $breakpoint-mobile) {
  .nav-area.-resilience.desktop-only {
    display: none !important;
  }
}
