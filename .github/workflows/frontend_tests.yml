name: Frontend Tests

on:
  push:
    paths:
      - 'frontend/**'
      - '.github/workflows/frontend_tests.yml'
      - 'docker-compose.test.yml'
  pull_request:
    paths:
      - 'frontend/**'
      - '.github/workflows/frontend_tests.yml'
      - 'docker-compose.test.yml'
  workflow_dispatch:

env:
  DOCKER_BUILDKIT: 1
  COMPOSE_DOCKER_CLI_BUILD: 1

jobs:
  # Fast lint/type-check jobs without Docker - runs directly with Node.js
  frontend-quick-checks:
    name: Frontend Quick Checks - ${{ matrix.suite }}
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    strategy:
      fail-fast: false
      matrix:
        suite: [lint, type-check, prettier]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version-file: 'frontend/.nvmrc'
        cache: 'npm'
        cache-dependency-path: 'frontend/package-lock.json'
    
    - name: Install dependencies
      working-directory: frontend
      run: npm ci --legacy-peer-deps --no-audit --no-fund
    
    - name: Run ESLint
      if: matrix.suite == 'lint'
      working-directory: frontend
      run: ./bin/test lint
    
    - name: Run TypeScript check
      if: matrix.suite == 'type-check'
      working-directory: frontend
      run: ./bin/test type-check
    
    - name: Run Prettier check
      if: matrix.suite == 'prettier'
      working-directory: frontend
      run: ./bin/test prettier

  # Build test - runs directly with Node.js
  frontend-build:
    name: Frontend Build Test
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version-file: 'frontend/.nvmrc'
        cache: 'npm'
        cache-dependency-path: 'frontend/package-lock.json'
    
    - name: Install dependencies
      working-directory: frontend
      run: npm ci --legacy-peer-deps --no-audit --no-fund
    
    - name: Build application
      working-directory: frontend
      run: ./bin/test build

